<div class="content-area">
  <header class="content-header">
    <div class="header-title">
      <h1><i class="fas fa-calendar-alt"></i> Mes Rendez-vous</h1>
    </div>
  </header>

  <div class="calendar-controls">
  <button class="nav-btn" (click)="previousMonth()">
    <i class="fas fa-arrow-left"></i>
  </button>

  <h2>
    <i class="fas fa-calendar-alt"></i>
    {{ currentMonthName }} {{ currentYear }}
  </h2>

  <button class="nav-btn" (click)="nextMonth()">
    <i class="fas fa-arrow-right"></i>
  </button>
</div>

  <!-- Calendrier -->
  <div class="calendar-grid">
    <!-- Jours de la semaine -->
    @for (day of daysOfWeek; track $index) {
      <div class="calendar-day-header">{{ day }}</div>
    }
    @for (day of calendarDays; track $index) {
      <div class="calendar-day"
           [class.other-month]="day.otherMonth"
           [class.today]="day.isToday"
           [class.has-appointments]="day.appointments.length > 0"
           (click)="selectDay(day)">
        <div class="day-number">{{ day.date.getDate() }}</div>
        @if (day.appointments.length > 0) {
          <div class="appointments-list">
            @for (appt of day.appointments; track $index) {
              <div class="appointment-item" (click)="$event.stopPropagation()">
                <i class="fas fa-clock"></i>
                {{ appt.heure }} - Dr {{medecin.nom}}
              </div>
            }
          </div>
        }
      </div>
    }
  </div>

  <!-- Selected Day Appointments -->
  @if (selectedDay && selectedDay.appointments.length > 0) {
    <div class="selected-day">
      <h3>
        <i class="fas fa-calendar-day"></i> Rendez-vous du {{ selectedDay.date | date:'EEEE d MMMM yyyy' }}
      </h3>
      <ul>
        @for (appt of selectedDay.appointments; track $index) {
          <li>
            <div class="appt-info">
              <div class="appt-time">{{ appt.heure }} - Dr {{medecin.nom}} {{medecin.prenom}} - {{medecin.specialite}}</div>
              <span class="appt-status" [class.status-annule]="appt.statut === 'Annulé' || appt.statut === 'annulé'">
                {{ appt.statut }}
              </span>
            </div>
            <div class="appt-actions">
              <button class="btn-dossier" (click)="goToDossier()" title="Accéder au dossier médical">
                <i class="fas fa-file-medical"></i>
                <span>Dossier médical</span>
              </button>
              @if (appt.statut !== 'Annulé' && appt.statut !== 'annulé') {
                <button class="btn-modifier" (click)="openModal(appt)">
                  <i class="fas fa-edit"></i>
                  <span>Modifier</span>
                </button>
                <button class="btn-annuler" (click)="annulerRdv(appt)">
                  <i class="fas fa-times"></i>
                  <span>Annuler</span>
                </button>
              }
            </div>
          </li>
        }
      </ul>
    </div>
  }
  
</div>
<!-- Edit RDV Modal -->
@if (showEditModal) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h2><i class="fas fa-edit"></i> Modifier le Rendez-vous</h2>
      <form (ngSubmit)="updateRdv()" #editForm="ngForm">
        <div class="form-group">
          <label for="newDate"><i class="fas fa-calendar-alt"></i> Nouvelle date</label>
          <input type="date" id="newDate" [(ngModel)]="editDate" name="newDate" required>
        </div>
        <div class="form-group">
          <label for="newHeure"><i class="fas fa-clock"></i> Nouvelle heure</label>
          <input type="time" id="newHeure" [(ngModel)]="editHeure" name="newHeure" required>
        </div>
        <div class="modal-actions">
          <button type="submit" class="btn-save"><i class="fas fa-save"></i> Enregistrer</button>
          <button type="button" (click)="closeModal()" class="btn-cancel"><i class="fas fa-times"></i> Fermer</button>
        </div>
      </form>
    </div>
  </div>
}
